import{l as f,m as d,s as u,h as g,a as c}from"./index-CYA54aLl.js";import"./app-B7y11r-n.js";import"./sweetalert2-B0Dix5B2.js";import"./axios-D8rVyQy1.js";import"./jquery-Cbw-UD5s.js";import"./jszip-iaRLBgVt.js";import"./pdfmake-DIF5dMoL.js";import"./lodash-DeFuYRHF.js";import"./dropzone-y6Y7QKyv.js";import"./just-extend-DZ8Smc-h.js";import"./datatables.net-B-RIlqBn.js";import"./datatables.net-buttons-BGn0gpHj.js";import"./datatables.net-responsive-DZCnhbGj.js";import"./lucide-_Yz-U2iH.js";import"./alpinejs-Cm4okMZt.js";import"./apexcharts-DfcQ-EiH.js";document.addEventListener("DOMContentLoaded",function(){document.getElementById("loginForm").addEventListener("submit",function(n){var o,l,m;n.preventDefault(),f();const r=((o=document.getElementById("usuario"))==null?void 0:o.value.trim())||"",i=((l=document.getElementById("contrasena"))==null?void 0:l.value.trim())||"",t=((m=document.getElementById("codigo_2fa"))==null?void 0:m.value.trim())||"";if(!r||!i){d({usuario:r?[]:["El usuario es obligatorio."],contrasena:i?[]:["La contraseña es obligatoria."]});return}let a={usuario:r,contrasena:i};t&&(a.codigo_2fa=t),u("/api/auth/login","POST",a,e=>{if(e.resultado){if(localStorage.setItem("token",e.token),localStorage.setItem("roles",JSON.stringify(e.roles)),localStorage.setItem("permisos",JSON.stringify(e.permisos)),e.clave_2fa){console.warn("Se requiere configuración de 2FA."),localStorage.setItem("clave_2fa",e.clave_2fa),localStorage.setItem("clave_2fa_url",e.clave_2fa_url),window.location.href="/registro-2fa";return}window.location.href="/home"}else d(e.errors||{error:[e.message]})},e=>{console.error("Error en login:",e),g(e)})})});document.addEventListener("DOMContentLoaded",function(){const s=document.getElementById("spinner"),n=document.getElementById("clave2AFQr"),r=document.getElementById("clave2AF");s.style.display="inline-block",n.style.display="none",r.textContent="Cargando...",setTimeout(()=>{let t=localStorage.getItem("clave_2fa"),a=localStorage.getItem("clave_2fa_url");r.textContent=t||"No disponible",a&&(n.src=a,n.style.display="block"),s.style.display="none"},2e3);const i=document.querySelector("#verificar_2af_registro");i&&i.addEventListener("click",function(){let t="";if(document.querySelectorAll("[data-hs-pin-input-item]").forEach(o=>{t+=o.value.trim()}),t.length!==6||isNaN(t)){c("warning","Por favor ingresa un código válido de 6 dígitos.");return}if(!localStorage.getItem("token")){c("error","Sesión expirada. Inicia sesión nuevamente.",{confirmText:"Ir al inicio"}).then(()=>{window.location.href="/login"});return}u("/api/auth/verificar-2fa","POST",{codigo_2fa:t,error_input:400},o=>{let l=o.data||o;l.resultado?c("success","Autenticación exitosa. Redirigiendo...","",{timer:2e3}).then(()=>{window.location.href="/home"}):c("error","Código 2FA inválido. Intenta nuevamente.",l.message||"Código incorrecto. Intenta de nuevo.")},o=>{g(o)})})});
